# Backchannel Detection for Voice AI

A real-time ML system to detect back-channel utterances ("mhm", "yeah", "makes sense") in voice conversations with <50ms latency.

## Project Structure

```
├── fastapi/                   # Production API server
│   ├── app/main.py           # FastAPI endpoints
│   ├── src/models.py         # Baseline & ML model implementations
│   ├── src/weights/          # Trained model files
│   └── dockerfile            # Container config
├── training/train.py         # Model training pipeline
├── requirements.txt          # Dependencies
└── dataset                   # dataset gen strategies
    ├── dataset_gen.py
    ├── Dockerfile
    ├── backchannel_dataset_cleaned.csv
    ├── synthetic_dataset_claude.csv
    └── synthetic_dataset_gemini.csv
└── sharedlib
└── stress_test
└── requirements.txt
└── dockerfiles
```

## Quick Start

### 1. Generate Dataset
The dataset can be generated by running the `dataset_gen.py` script inside a Docker container. This script uses the `convokit` library to process the Switchboard corpus and also combines it with synthetic data.

```bash
# Navigate to the dataset directory
cd dataset

# Build the Docker image
docker build -t dataset-generator .

# Run the container to generate the dataset
docker run --rm -v "$(pwd)":/app dataset-generator
```
This will create/update the `backchannel_dataset_cleaned.csv` file in the `dataset` directory.

### 2. Train Models
```bash
# Prepare CSV with columns: previous_clean, current_clean, label
python training/train.py --training-file dataset/backchannel_dataset_cleaned.csv --output-dir ./output

# Copy trained model to API
cp output/backchannel_model_*.joblib fastapi/src/weights/trained_model.joblib
```

### 3. Run API
```bash
# Local
cd fastapi && uvicorn app.main:app --host 0.0.0.0 --port 8000

# Docker
cd fastapi && docker build -t backchannel-api . && docker run -p 8000:80 backchannel-api
```

## API Usage

**Endpoints:**
- `POST /baseline` - Keyword lookup model
- `POST /tfidfmodel` - Trained tfidf model
- `Post /fasttextmodel` - Trained FastText model


**Request:**
```json
{
  "agent_text": "We have a meeting at 3pm",
  "partial_transcript": "okay"
}
```

**Response:**
```json
{
  "is_backchannel": true,
  "confidence": 0.85
}
```
